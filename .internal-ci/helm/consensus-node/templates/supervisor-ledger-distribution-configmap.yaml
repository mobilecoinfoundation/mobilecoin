# Copyright (c) 2018-2022 The MobileCoin Foundation
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "consensusNode.fullname" . }}-supervisor-ledger-distribution
  labels:
    {{- include "consensusNode.labels" . | nindent 4 }}
data:
  ledger_dist.conf: |
    [program:ledger-distribution]
    priority=20
    environment=MC_SENTRY_DSN="%(ENV_LEDGER_DISTRIBUTION_SENTRY_DSN)s"
    command=/usr/bin/ledger-distribution
      --dest "%(ENV_LEDGER_DISTRIBUTION_S3_PATH)s"
      --ledger-path /ledger
      --state-file /ledger/.distribution-state
      --start-from "%(ENV_LEDGER_DISTRIBUTION_START_FROM)s"

    stdout_logfile=/dev/fd/1
    stdout_logfile_maxbytes=0
    stderr_logfile=/dev/fd/2
    stderr_logfile_maxbytes=0
    autorestart=true
